-- Таблица пользователей
CREATE TABLE app_user (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    username VARCHAR2(255) NOT NULL UNIQUE,
    password VARCHAR2(255) NOT NULL,
    name VARCHAR2(50) NOT NULL,
    surname VARCHAR2(50) NOT NULL,
    parent_name VARCHAR2(50) NOT NULL,
    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_edit_date TIMESTAMP NOT NULL
);

-- Таблица новостей
CREATE TABLE news (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    title VARCHAR2(150) NOT NULL,
    text CLOB NOT NULL,
    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_edit_date TIMESTAMP NOT NULL,
    created_by_user NUMBER NOT NULL,
    updated_by_user NUMBER,
    CONSTRAINT fk_news_created_by FOREIGN KEY (created_by_user) REFERENCES app_user(id) ON DELETE CASCADE,
    CONSTRAINT fk_news_updated_by FOREIGN KEY (updated_by_user) REFERENCES app_user(id) ON DELETE SET NULL
);

-- Таблица комментариев
CREATE TABLE comments (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    text VARCHAR2(300) NOT NULL,
    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_edit_date TIMESTAMP NOT NULL,
    created_by_user NUMBER NOT NULL,
    news_id NUMBER NOT NULL,
    CONSTRAINT fk_comment_user FOREIGN KEY (created_by_user) REFERENCES app_user(id) ON DELETE CASCADE,
    CONSTRAINT fk_comment_news FOREIGN KEY (news_id) REFERENCES news(id) ON DELETE CASCADE
);

-- Вставка пользователей
INSERT INTO app_user (username, password, name, surname, parent_name, creation_date, last_edit_date) VALUES
  ('alice', 'pass123', 'Alice', 'Smith', 'Marie', CURRENT_TIMESTAMP - INTERVAL '15' DAY, CURRENT_TIMESTAMP - INTERVAL '14' DAY),
  ('bob',   'pass123', 'Bob',   'Johnson', 'Edward', CURRENT_TIMESTAMP - INTERVAL '14' DAY, CURRENT_TIMESTAMP - INTERVAL '13' DAY),
  ('carol', 'pass123', 'Carol', 'Williams', 'Helen', CURRENT_TIMESTAMP - INTERVAL '13' DAY, CURRENT_TIMESTAMP - INTERVAL '12' DAY),
  ('dave',  'pass123', 'Dave',  'Brown', 'George', CURRENT_TIMESTAMP - INTERVAL '12' DAY, CURRENT_TIMESTAMP - INTERVAL '11' DAY);

-- Вставка новостей
INSERT INTO news (title, text, created_by_user, updated_by_user, creation_date, last_edit_date) VALUES
  ('Новость 1', 'Текст новости 1', 1, 2, CURRENT_TIMESTAMP - INTERVAL '10' DAY, CURRENT_TIMESTAMP - INTERVAL '9' DAY),
  ('Новость 2', 'Текст новости 2', 2, 3, CURRENT_TIMESTAMP - INTERVAL '9' DAY, CURRENT_TIMESTAMP - INTERVAL '8' DAY),
  ('Новость 3', 'Текст новости 3', 3, 4, CURRENT_TIMESTAMP - INTERVAL '8' DAY, CURRENT_TIMESTAMP - INTERVAL '7' DAY),
  ('Новость 4', 'Текст новости 4', 1, 3, CURRENT_TIMESTAMP - INTERVAL '7' DAY, CURRENT_TIMESTAMP - INTERVAL '6' DAY),
  ('Новость 5', 'Текст новости 5', 2, 1, CURRENT_TIMESTAMP - INTERVAL '6' DAY, CURRENT_TIMESTAMP - INTERVAL '5' DAY);

-- Вставка комментариев
INSERT INTO comments (text, created_by_user, news_id, creation_date, last_edit_date) VALUES
  ('Комментарий 1 к новости 1', 2, 1, CURRENT_TIMESTAMP - INTERVAL '9' DAY, CURRENT_TIMESTAMP - INTERVAL '8' DAY),
  ('Комментарий 2 к новости 1', 3, 1, CURRENT_TIMESTAMP - INTERVAL '8' DAY, CURRENT_TIMESTAMP - INTERVAL '7' DAY),
  ('Комментарий 3 к новости 1', 4, 1, CURRENT_TIMESTAMP - INTERVAL '7' DAY, CURRENT_TIMESTAMP - INTERVAL '6' DAY),

  ('Комментарий 1 к новости 2', 1, 2, CURRENT_TIMESTAMP - INTERVAL '8' DAY, CURRENT_TIMESTAMP - INTERVAL '7' DAY),
  ('Комментарий 2 к новости 2', 3, 2, CURRENT_TIMESTAMP - INTERVAL '7' DAY, CURRENT_TIMESTAMP - INTERVAL '6' DAY),

  ('Комментарий 1 к новости 3', 1, 3, CURRENT_TIMESTAMP - INTERVAL '6' DAY, CURRENT_TIMESTAMP - INTERVAL '5' DAY),
  ('Комментарий 2 к новости 3', 2, 3, CURRENT_TIMESTAMP - INTERVAL '5' DAY, CURRENT_TIMESTAMP - INTERVAL '4' DAY),

  ('Комментарий 1 к новости 4', 3, 4, CURRENT_TIMESTAMP - INTERVAL '4' DAY, CURRENT_TIMESTAMP - INTERVAL '3' DAY),
  ('Комментарий 2 к новости 4', 4, 4, CURRENT_TIMESTAMP - INTERVAL '3' DAY, CURRENT_TIMESTAMP - INTERVAL '2' DAY),

  ('Комментарий 1 к новости 5', 1, 5, CURRENT_TIMESTAMP - INTERVAL '2' DAY, CURRENT_TIMESTAMP - INTERVAL '1' DAY),
  ('Комментарий 2 к новости 5', 2, 5, CURRENT_TIMESTAMP - INTERVAL '1' DAY, CURRENT_TIMESTAMP);

COMMIT;
